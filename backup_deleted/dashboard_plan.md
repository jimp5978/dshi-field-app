# DSHI Dashboard 개발 및 배포 계획서

> 📅 **작성일**: 2025-08-01  
> 🎯 **상태**: 계획 수립 완료 - Sinatra 기반 Dashboard 개발 확정  
> 🏗️ **기술스택**: Sinatra + Python API + MySQL  
> 🚀 **배포방식**: Docker 없는 직접 배포 (테스트 단계)

---

## 📋 프로젝트 개요

### 🎯 **목적**
- **현장 관리 데이터 시각화**: DSHI 조립품 진행 현황 실시간 모니터링
- **관리자 대시보드**: Level 3+ (DSHI 관리자) 전용 데이터 분석 도구
- **기존 시스템 연동**: Flutter 앱 + Flask API와 완벽 연동

### ✅ **기술스택 확정 사유**

#### **Sinatra 선택 이유** ⭐
1. **기존 시스템 일관성**: 로그인/인증이 이미 Sinatra에서 완벽 동작
2. **경량성**: Dashboard 특성상 단순 데이터 시각화가 목적
3. **개발 효율성**: Rails 대비 3-5배 빠른 개발 속도
4. **검증된 성공**: Phase 7까지 완료된 고도화 시스템 존재
5. **리소스 효율**: Rails 대비 메모리 사용량 1/3 수준


---

## 🏗️ 시스템 아키텍처

### **최종 확정 구조**
```
📱 Flutter 앱 ←→ 🔧 Flask API (5001) ←→ 🗄️ MySQL DB
                                ↕️
📊 Sinatra Dashboard (5008) ←→ 🐍 dashboard_api.py ←→ (동일한 MySQL)
```

### **기술 스택**
- **Frontend**: Sinatra + ERB 템플릿 + CSS Grid
- **Backend**: Python dashboard_api.py (Flask API 연동)
- **Database**: MySQL (기존 field_app_db 활용)
- **인증**: 기존 Sinatra JWT 시스템 활용
- **포트**: 5008 (외부 접속용)

### **데이터 흐름**
1. **실시간 데이터**: dashboard_api.py → Flask API → MySQL 조회
2. **모의 데이터**: API 실패시 하드코딩된 DSHI 실제 데이터 활용
3. **자동 복구**: 네트워크 오류시 모의 데이터로 자동 전환

---

## 🎨 Dashboard 기능 설계

### **화면 구성** 
#### **6개 섹션 대시보드**
1. **📈 전체 현황**: 조립품 진행률
2. **🔧 7단계 공정 완료율**: Fit-up → PACKING 시각화
3. **📊 상태별 분포**: 완료/진행중/대기/지연 실시간 통계
4. **📅 월별 진행률**: 계획 대비 실제 완료율
5. **🏢 업체별 비율**: 사내업체/외부업체 진행 현황
6. **⚠️ 이슈 추적**: 지연/문제 발생 항목 알림

### **핵심 기능**
- **실시간 업데이트**: 5분마다 자동 새로고침
- **반응형 디자인**: 태블릿/PC 최적화
- **권한 기반 접근**: Level 3+ 접근 제한
- **오류 복원력**: API 장애시 모의 데이터 표시

---

## 🚀 배포 전략

### **테스트 단계 배포** (현재)

#### **Docker 없는 직접 배포** ⭐ (확정)
- **서버**: 현재 203.251.108.199 활용
- **포트**: 5008 (5007은 개발용)
- **비용**: 0원 (기존 서버 활용)
- **배포 시간**: 5분 내 완료

#### **배포 절차**
```bash
# 1. 기존 backup_deleted에서 파일 복원
cp backup_deleted/run_dashboard.rb dshi_dashboard/
cp -r backup_deleted/views dshi_dashboard/
cp -r backup_deleted/lib dshi_dashboard/

# 2. 포트 변경 (5007 → 5008)
sed -i 's/5007/5008/g' run_dashboard.rb

# 3. 외부 접속 허용 확인
set :bind, '0.0.0.0'

# 4. 백그라운드 실행
nohup ruby run_dashboard.rb > dashboard.log 2>&1 &

# 5. 접속 확인
curl http://203.251.108.199:5008/health
```

#### **접속 정보**
- **내부**: `http://localhost:5008`
- **외부**: `http://203.251.108.199:5008`
- **로그인**: 기존 Sinatra 계정 공유

### **정식 배포 계획** (결재 후)

#### **상용 환경 옵션**
1. **클라우드 VPS**: DigitalOcean/Vultr (월 6달러)
2. **도메인 + HTTPS**: SSL 인증서 적용
3. **Docker 환경**: 완전한 컨테이너 기반 배포
4. **모니터링**: 로그 수집 및 알림 시스템

---

## 📁 파일 구조 계획

### **복원 예정 파일들**
```
dshi_dashboard/
├── run_dashboard.rb ⭐ (메인 Sinatra 애플리케이션)
├── dashboard_api.py ⭐ (Python API 브리지)
├── Gemfile ⭐ (Ruby 의존성 - 생성 필요)
├── views/
│   └── index.erb ⭐ (대시보드 UI 템플릿)
├── lib/
│   ├── auth_helper.rb (인증 헬퍼)
│   └── api_client.rb (API 클라이언트)
└── public/
    ├── css/ (스타일시트)
    └── js/ (JavaScript)
```

### **새로 생성할 파일**
- **Gemfile**: 최소 의존성 (sinatra, webrick, jwt, net-http)
- **config.ru**: Rack 설정 (필요시)
- **dashboard.log**: 실행 로그 파일

---

## ⏱️ 개발 일정

### **Phase 1: 기본 시스템 복원** (1일)
- ✅ backup_deleted에서 파일 복원
- ✅ Gemfile 생성 및 의존성 설치
- ✅ 기본 Sinatra 앱 실행 확인
- ✅ Python API 연동 테스트

### **Phase 2: Dashboard 구현** (1일)
- 📊 6개 섹션 대시보드 UI 구현
- 📈 실시간 데이터 연동
- 🎨 반응형 CSS Grid 레이아웃
- ⚡ 자동 새로고침 JavaScript

### **Phase 3: 테스트 배포** (0.5일)
- 🚀 외부 포트 (5008) 배포
- 🔐 인증 시스템 연동 확인
- 📱 모바일/태블릿 호환성 테스트
- ⚠️ 오류 복원력 테스트

---

## 🔐 보안 및 접근 제어

### **인증 시스템**
- **기존 시스템 활용**: Sinatra JWT 토큰 공유
- **권한 확인**: Level 4+ 접근 제한
- **세션 관리**: 기존 로그인 시스템과 동일

### **네트워크 보안**
- **방화벽**: 5008 포트 외부 접속 허용
- **HTTPS**: 정식 배포시 SSL 인증서 적용
- **접근 로그**: dashboard.log로 접속 기록

---

## 📊 성능 및 모니터링

### **성능 목표**
- **응답 시간**: 페이지 로드 2초 이내
- **데이터 업데이트**: 5분 간격 자동 새로고침
- **동시 접속**: 10명 이하 (테스트 단계)

### **모니터링 항목**
- **서버 상태**: dashboard.log 모니터링
- **API 연동**: Flask API 응답 시간
- **데이터 정확성**: MySQL 데이터 동기화

---

## 💰 비용 분석

### **테스트 단계** (현재)
- **서버 비용**: 0원 (기존 서버 활용)
- **개발 시간**: 2.5일
- **유지보수**: 최소 (단순 구조)

### **정식 배포** (결재 후)
- **VPS 서버**: 월 6달러 (DigitalOcean)
- **도메인**: 연 15달러
- **SSL 인증서**: 무료 (Let's Encrypt)
- **총 예상 비용**: 월 6달러 + 연 15달러

---

## 🎯 성공 지표

### **기술적 성공 지표**
- ✅ 외부 접속 가능 (203.251.108.199:5008)
- ✅ 실시간 데이터 표시 (5분 간격)
- ✅ 모든 6개 섹션 정상 작동
- ✅ 모바일/태블릿 호환성

### **사용자 경험 지표**
- ✅ 직관적인 데이터 시각화
- ✅ 빠른 로딩 속도 (2초 이내)
- ✅ 안정적인 시스템 운영
- ✅ 권한별 접근 제어 정상 작동

---

## 📋 체크리스트

### **개발 전 준비사항**
- [ ] backup_deleted 폴더 파일 현황 확인
- [ ] 현재 MySQL 데이터베이스 연결 상태 확인
- [ ] Flask API (5001) 정상 작동 확인
- [ ] 포트 5008 방화벽 설정 확인

### **개발 완료 체크리스트**
- [ ] Sinatra 앱 로컬 실행 확인 (5008)
- [ ] Python API 연동 테스트
- [ ] 6개 대시보드 섹션 구현
- [ ] 외부 접속 테스트
- [ ] 인증 시스템 연동 확인
- [ ] 모바일 호환성 테스트
- [ ] 오류 상황 복원력 테스트

---

## 🔄 향후 확장 계획

### **Phase 4: 고도화** (정식 배포 후)
- **실시간 알림**: 지연 발생시 이메일/SMS 알림
- **Excel 내보내기**: 현황 데이터 Excel 다운로드
- **히스토리 추적**: 진행률 변화 그래프
- **사용자 관리**: Level 5+ 사용자 대시보드 접근 관리

### **Phase 5: 통합 관리**
- **Flutter 앱 연동**: 대시보드에서 직접 검사신청 관리
- **통계 분석**: 월별/분기별 진행률 분석
- **예측 모델**: AI 기반 완료 예상일 계산

---

*📅 **작성일**: 2025-08-01*  
*🎯 **상태**: ✅ **계획 수립 완료 - Sinatra 기반 Dashboard 개발 확정**  
*🏗️ **기술스택**: Sinatra + Python API + MySQL (Docker 없는 직접 배포)  
*🚀 **예상 개발 기간**: 2.5일 (복원 1일 + 구현 1일 + 배포 0.5일)  
*💰 **테스트 비용**: 0원 (기존 서버 활용) / 정식 배포: 월 6달러*  
*📍 **배포 주소**: http://203.251.108.199:5008 (예정)*